<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2026å¤§å­¸æ–°é®®äººï½œåœ–æ›¸é¤¨ç„¡é™åŸå†’éšª</title>
  <meta name="theme-color" content="#ffffff" />
  <style>
    :root{
      --bg:#f7fafc;
      --text:#0f172a;
      --muted:#64748b;
      --panel:#ffffff;
      --line:#e5e7eb;
      --brand:#2563eb;
      --brand-2:#22c55e;
      --accent:#0ea5e9;
      --shadow:0 10px 25px rgba(15,23,42,.08);
      --radius:16px;
      --ring: rgba(37, 99, 235, .25);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, 'Helvetica Neue', Arial, 'Apple Color Emoji', 'Segoe UI Emoji';
      color:var(--text);
      background: radial-gradient(1200px 800px at 80% -10%, rgba(37,99,235,.08), transparent 55%),
                  radial-gradient(900px 700px at 0% 30%, rgba(14,165,233,.08), transparent 55%),
                  var(--bg);
      display:grid; grid-template-rows:auto auto 1fr; min-height:100vh;
    }
    .site-title{ padding:22px 16px 4px; }
    .site-title h1{ margin:0; font-size: clamp(20px, 4.2vw, 30px); font-weight:800; letter-spacing:.2px; }
    .progress-wrap { padding: 8px 16px 14px; }
    .steps { display:grid; grid-template-columns: repeat(6,1fr); gap:8px; margin-bottom:10px; }
    .step { display:grid; place-items:center; gap:6px; color:var(--muted); font-size:11px; user-select:none; }
    .step .dot{ width:28px; height:28px; border-radius:999px; display:grid; place-items:center; font-weight:800; background:#fff; border:1px solid var(--line); box-shadow:0 0 0 0 var(--ring); transition:.18s; }
    .step.active .dot,.step.done .dot{ background: linear-gradient(180deg, var(--brand), #60a5fa); color:#fff; border-color: transparent; box-shadow: 0 0 0 6px var(--ring); }
    .bar { width:100%; height:8px; background:#e5e7eb; border-radius:999px; overflow:hidden; position:relative; }
    .bar > i { display:block; height:100%; width: var(--p,0%); background: linear-gradient(90deg, var(--brand), var(--brand-2)); transition: width .35s ease; }
    .container{ padding:12px 16px 60px; display:grid; gap:18px; }
    .intro{ background:var(--panel); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); padding:18px; }
    .intro h2{ margin:0 0 8px; font-size: clamp(18px, 3.6vw, 22px); }
    .intro p{ margin:8px 0; color:var(--text); line-height:1.7; }
    .intro .note{ margin-top:10px; padding:8px 12px; border-radius:12px; background:#eef6ff; color:#1e40af; border:1px solid #bfdbfe; font-weight:700; }
    .panel{ background:var(--panel); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); padding:18px; }
    .panel h3{ margin:0 0 12px; font-size:18px; }
    .grid{ display:grid; gap:12px; grid-template-columns: 1fr; }
    @media (min-width:720px){ .grid{ grid-template-columns: repeat(3, 1fr); } }
    .field{ display:grid; gap:6px; }
    .label{ font-weight:700; font-size:13px; }
    .input{ padding:10px 12px; border-radius:12px; border:1px solid var(--line); background:#fff; font-size:14px; }
    .help{ margin-top:8px; padding:8px 12px; border-radius:12px; background:#e0f2fe; color:#075985; border:1px solid #bae6fd; font-size:13px; }
    .form-message{
      margin-top:10px;
      font-size:13px;
      font-weight:700;
      min-height:18px;
    }
    .form-message.error{ color:#b91c1c; }
    .form-message.success{ color:#15803d; }
    .actions{ display:flex; flex-wrap:wrap; gap:10px; margin-top:12px; }
    .btn{ appearance:none; border:0; border-radius:12px; padding:12px 14px; font-weight:800; font-size:14px; text-decoration:none; cursor:pointer; }
    .btn.primary{ color:#fff; background:linear-gradient(180deg,#3b82f6,#2563eb); box-shadow:var(--shadow); }
    .btn.outline{ background:#fff; color:#0f172a; border:1px solid var(--line); }

    /* ğŸ”„ å…¨è¢å¹•è¼‰å…¥ç·©è¡é ï¼ˆé–‹å§‹å†’éšª â†’ å¯«å…¥ â†’ é€²ä»»å‹™ä¸€ï¼‰ */
    .loading-overlay{
      position:fixed;
      inset:0;
      background:rgba(248,250,252,.95);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:999;
      flex-direction:column;
      text-align:center;
      padding:24px;
    }
    .loading-overlay.show{
      display:flex;
    }
    .loading-overlay h2{
      margin:8px 0 4px;
      font-size:18px;
    }
    .loading-overlay p{
      margin:0;
      font-size:14px;
      color:var(--muted);
    }
    .loader-dot{
      width:10px;
      height:10px;
      border-radius:999px;
      background:var(--brand);
      margin:0 3px;
      animation:bounce 0.9s infinite alternate;
      display:inline-block;
    }
    .loader-dot:nth-child(2){ animation-delay:.15s; }
    .loader-dot:nth-child(3){ animation-delay:.3s; }
    @keyframes bounce{
      from{ transform:translateY(0); opacity:.4; }
      to{ transform:translateY(-6px); opacity:1; }
    }
  </style>
</head>
<body>
  <header class="site-title">
    <h1>2026å¤§å­¸æ–°é®®äºº-åœ–æ›¸é¤¨ç„¡é™åŸå†’éšª</h1>
  </header>
  <section class="progress-wrap" aria-label="ä»»å‹™é€²åº¦">
    <div class="steps" id="steps">
      <div class="step active" data-step="1" aria-current="step"><div class="dot">1</div>é¦–é </div>
      <div class="step" data-step="2"><div class="dot">2</div>ä»»å‹™ä¸€</div>
      <div class="step" data-step="3"><div class="dot">3</div>ä»»å‹™äºŒ</div>
      <div class="step" data-step="4"><div class="dot">4</div>ä»»å‹™ä¸‰</div>
      <div class="step" data-step="5"><div class="dot">5</div>å·¥å•†</div>
      <div class="step" data-step="6"><div class="dot">6</div>å®Œæˆ</div>
    </div>
    <div class="bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-label="å®Œæˆç™¾åˆ†æ¯”"><i id="bar"></i></div>
  </section>
  <main class="container" id="main">
    <section class="intro">
      <h2>2026å¤§å­¸æ–°é®®äºº-åœ–æ›¸é¤¨ç„¡é™åŸå†’éšªâ†’ GO! </h2>
      <h2>å°‹æ‰¾é™¢å‰ç¥¥ç‰©ï¼æ¿Ÿæ™‚æ¨“åœ–æ›¸é¤¨VRäº’å‹•é«”é©—å¤§åœ°éŠæˆ²</h2>
      <p>æƒ³ç”¨ä¸ä¸€æ¨£çš„æ–¹å¼èªè­˜æ¿Ÿæ™‚æ¨“åœ–æ›¸é¤¨å—ï¼Ÿ</p>
      <p>ã€Œæ¿Ÿæ™‚æ¨“åœ–æ›¸é¤¨VRäº’å‹•é«”é©—å¤§åœ°éŠæˆ²ã€æ­£å¼å•Ÿå‹•ï¼</p>
      <p>æˆ‘å€‘å°‡å„å­¸é™¢çš„å¯æ„›å‰ç¥¥ç‰©å·§å¦™åœ°èå…¥åœ–æ›¸é¤¨ç©ºé–“ï¼Œæ‰“é€ ç¨ç‰¹çš„å°‹å¯¶é«”é©—ã€‚</p>
      <p>æ­¡è¿æ‚¨æ‹¿èµ·æ‰‹æ©Ÿï¼Œå±•é–‹ä¸€å ´çµåˆè™›æ“¬èˆ‡ç¾å¯¦çš„æ¢ç´¢å†’éšªï¼Œ</p>
      <p>å°‡ä»–å€‘ä¸€ä¸€æ‰¾å‡ºä¾†å§ï¼</p>
      <p class="note">ğŸ å…¨éƒ¨é€šé—œå®Œæˆå¾Œï¼Œè«‹è¨˜å¾—å‰å¾€æ¿Ÿæ™‚æ¨“äºŒæ¨“æ«ƒå°é ˜å–ä½ çš„å°ˆå±¬å°ç¦®ç‰©å–”ï¼ <br>æº–å‚™å¥½ä½ çš„æ¢ç´¢ç²¾ç¥ï¼Œä¸€èµ·ä¾†å°‹å¯¶å§ï¼GOï¼GOï¼GOï¼</p>
    </section>
    <section class="panel">
      <h3>åŸºæœ¬è³‡æ–™èªè­‰</h3>
      <div class="grid">
        <div class="field">
          <label class="label" for="sid">å­¸è™Ÿ *</label>
          <input class="input" id="sid" placeholder="è«‹è¼¸å…¥å­¸è™Ÿ" />
        </div>
        <div class="field">
          <label class="label" for="name">å§“å *</label>
          <input class="input" id="name" placeholder="è«‹è¼¸å…¥å§“å" />
        </div>
        <div class="field">
          <label class="label" for="mail">Email *</label>
          <input class="input" id="mail" type="email" placeholder="è«‹è¼¸å…¥å¸¸ç”¨ Email" />
        </div>
      </div>
      <div class="help">è«‹ç¢ºèªå­¸è™Ÿã€å§“åèˆ‡ Email å¡«å¯«æ­£ç¢ºï¼Œä¹‹å¾Œå°‡ç”¨æ–¼èªè­‰é—–é—œç´€éŒ„ã€‚</div>
      <p id="formMessage" class="form-message" role="alert" aria-live="polite"></p>
      <div class="actions">
        <button class="btn primary" id="startBtn" type="button">é–‹å§‹å†’éšª</button>
      </div>
    </section>
  </main>

  <!-- ğŸ”„ è¼‰å…¥ç·©è¡é ï¼ˆindex â†’ mission1 æœŸé–“é¡¯ç¤ºï¼‰ -->
  <div class="loading-overlay" id="loadingOverlay" aria-hidden="true">
    <div>
      <div>
        <span class="loader-dot"></span>
        <span class="loader-dot"></span>
        <span class="loader-dot"></span>
      </div>
      <h2>è³‡æ–™åŒæ­¥ä¸­â€¦</h2>
      <p>æ­£åœ¨ç´€éŒ„ä½ çš„å†’éšªè€…èº«åˆ†ï¼Œè«‹ç¨å€™ç‰‡åˆ»ã€‚</p>
    </div>
  </div>

  <script>
    // âœ… ä½ çš„ GAS Web App URLï¼ˆåªå¯«å…¥ã€ä¸å›å‚³ï¼‰ â€” ä½¿ç”¨æœ€æ–°éƒ¨ç½²
    const GAS_URL = "https://script.google.com/macros/s/AKfycbyvqF1lKsFyRem_kGrPZ6uvmECjYsQHchxZK8VSrUXYbH27WaWBuN4Hr62QLPREHQ4l7w/exec";

    // ===== é€²åº¦æ¢é‚è¼¯ =====
    const TOTAL_STEPS = 6; // 1..6
    const CURRENT_STEP = 0; // é¦–é ç´¢å¼•

    const steps = Array.from(document.querySelectorAll('.step'));
    const bar = document.getElementById('bar');

    function renderProgress(){
      steps.forEach((el,i)=>{
        el.classList.remove('active','done');
        if(i === CURRENT_STEP) el.classList.add('active');
      });
      const percent = Math.round((CURRENT_STEP / (TOTAL_STEPS - 1)) * 100);
      bar.style.setProperty('--p', percent + '%');
      bar.parentElement.setAttribute('aria-valuenow', String(percent));
    }

    const qs = new URLSearchParams(location.search).get('step');
    if (qs) {
      const t = Math.max(1, Math.min(Number(qs), TOTAL_STEPS));
      steps.forEach((el,i)=>{
        el.classList.remove('active','done');
        if(i === (t-1)) el.classList.add('active');
      });
      const percent = Math.round(((t-1) / (TOTAL_STEPS - 1)) * 100);
      bar.style.setProperty('--p', percent + '%');
      bar.parentElement.setAttribute('aria-valuenow', String(percent));
    } else {
      renderProgress();
    }

    // ===== é¦–é æ¬„ä½è‡ªå‹•è¨˜ä½ï¼ˆlocalStorageï¼Œç©å®¶ç«¯è‡ªå·±ä¿ç•™è³‡æ–™ï¼‰ =====
    const fields=['sid','name','mail'];
    fields.forEach(id=>{
      const el=document.getElementById(id);
      const key='home_'+id;
      if(!el) return;
      const saved=localStorage.getItem(key);
      if(saved) el.value=saved;
      el.addEventListener('input',()=>localStorage.setItem(key,el.value||'')); // è¼¸å…¥å³å„²å­˜
    });

    // ===== è¡¨å–®è¨Šæ¯é¡¯ç¤º =====
    const formMessage = document.getElementById('formMessage');
    const sidInput    = document.getElementById('sid');
    const nameInput   = document.getElementById('name');
    const mailInput   = document.getElementById('mail');
    const startBtn    = document.getElementById('startBtn');
    const loadingOverlay = document.getElementById('loadingOverlay');

    function showFormMessage(text, type){
      if(!formMessage) return;
      formMessage.textContent = text || "";
      formMessage.classList.remove('error','success');
      if(type) formMessage.classList.add(type);
    }

    function showLoadingOverlay(show){
      if(!loadingOverlay) return;
      if(show){
        loadingOverlay.classList.add('show');
        loadingOverlay.setAttribute('aria-hidden', 'false');
      }else{
        loadingOverlay.classList.remove('show');
        loadingOverlay.setAttribute('aria-hidden', 'true');
      }
    }

    // ===== çµ±ä¸€å°è£ï¼šå¯«å…¥ä¸€ç­†äº‹ä»¶åˆ° Sheetï¼ˆç°¡å–®è«‹æ±‚ã€no-corsï¼Œé€ JSONï¼‰ =====
    async function logEventToSheet(payload){
      try{
        // é€™è£¡æ”¹æˆã€ŒJSON å­—ä¸²ã€+ no-corsï¼Œä¸åŠ ä»»ä½• Content-Type
        // â†’ ç€è¦½å™¨ç”¨ text/plain ç™¼é€
        // â†’ GAS ç«¯å¯ä»¥ç”¨ JSON.parse(e.postData.contents) æ­£å¸¸è§£æ
        const body = JSON.stringify({
          ...payload,
          ts: Date.now().toString()
        });

        await fetch(GAS_URL, {
          method: 'POST',
          mode: 'no-cors',
          body
        });

        // no-cors æ¨¡å¼ä¸‹ç„¡æ³•æª¢æŸ¥å›æ‡‰ï¼Œä½†æˆ‘å€‘åªéœ€è¦ã€Œç›¡åŠ›é€å‡ºã€å³å¯
      }catch(err){
        console.error('logEventToSheet error:', err);
      }
    }

    // ===== é»ã€Œé–‹å§‹å†’éšªã€ â†’ å¯«å…¥ä¸€ç­† register ç´€éŒ„ â†’ é¡¯ç¤ºç·©è¡é  â†’ é€²ä»»å‹™ä¸€ =====
    if(startBtn){
      startBtn.addEventListener('click', async (evt)=>{
        evt.preventDefault();

        const sid   = (sidInput.value  || '').trim();
        const name  = (nameInput.value || '').trim();
        const email = (mailInput.value || '').trim();

        if(!sid || !name || !email){
          showFormMessage('è«‹å®Œæ•´å¡«å¯«å­¸è™Ÿã€å§“åèˆ‡ Emailã€‚', 'error');
          return;
        }

        // å…ˆå¯«åˆ° localStorageï¼šç©å®¶è‡ªå·±çš„è£ç½®ä¿ç•™é€²åº¦èˆ‡èº«åˆ†
        localStorage.setItem('player_sid',   sid);
        localStorage.setItem('player_name',  name);
        localStorage.setItem('player_email', email);

        showFormMessage('è³‡æ–™é€å‡ºä¸­ï¼Œè«‹ç¨å€™â€¦', 'success');
        startBtn.disabled = true;

        // é¡¯ç¤ºå…¨è¢å¹•ç·©è¡ç•«é¢ï¼Œç•¶æˆ indexâ†’ä»»å‹™ä¸€çš„ã€Œè¼‰å…¥ç·©è¡é ã€
        showLoadingOverlay(true);

        // å°‡ã€Œé¦–é é–‹å§‹å†’éšªã€äº‹ä»¶è¨˜éŒ„åˆ° Sheetï¼ˆåªå¯«å…¥ä¸€æ¬¡ï¼Œä¸å›è®€ï¼‰
        logEventToSheet({
          action: 'register',
          page: 'index',
          event: 'start',
          sid,
          name,
          email
        });

        // ç„¡è«–å¯«å…¥æ˜¯å¦æˆåŠŸï¼Œéƒ½åœ¨çŸ­æš«ç·©è¡å¾Œé€²å…¥ä»»å‹™ä¸€ï¼ˆéŠæˆ²é‚è¼¯åœ¨å‰ç«¯ï¼Œä¸è¢«å¾Œç«¯é˜»æ“‹ï¼‰
        setTimeout(()=>{
          location.href = './pages/mission1.html';
        }, 900);
      });
    }
  </script>
</body>
</html>
